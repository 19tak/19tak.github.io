<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="본 포스팅은 KFQ 한국품질재단 인공지능 개발자 교육과정 1차 프로젝트의 발표 ppt 입니다." /><meta property="og:description" content="본 포스팅은 KFQ 한국품질재단 인공지능 개발자 교육과정 1차 프로젝트의 발표 ppt 입니다." /><link rel="canonical" href="https://19tak.github.io/posts/01-prj1/" /><meta property="og:url" content="https://19tak.github.io/posts/01-prj1/" /><meta property="og:site_name" content="19tak" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-20T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-16T16:26:29+09:00","datePublished":"2021-08-20T00:00:00+09:00","description":"본 포스팅은 KFQ 한국품질재단 인공지능 개발자 교육과정 1차 프로젝트의 발표 ppt 입니다.","headline":"[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측","mainEntityOfPage":{"@type":"WebPage","@id":"https://19tak.github.io/posts/01-prj1/"},"url":"https://19tak.github.io/posts/01-prj1/"}</script><title>[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측 | 19tak</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="19tak"><meta name="application-name" content="19tak"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://user-images.githubusercontent.com/84369912/127220954-701d3e97-6d9d-447a-b99f-1a31e4b7b03d.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">19tak</a></div><div class="site-subtitle">Peace n Love</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/19tak" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.instagram.com/taaaktaaaak" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://www.youtube.com/channel/UCse2sGik0zU4fVNZyDjhcOQ" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wjdxkrdl123','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>[KFQ] KFQ 1차 프로젝트 / 국내 영화관람객수 예측</h1><div class="post-meta text-muted"> <span> 게시 <em class="" data-ts="1629385200" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2021-08-20 </em> </span> <span> 업데이트 <em class="" data-ts="1665905189" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-10-16 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/19tak">19tak</a> </em> </span><div></div></div></div><div class="post-content"><p>본 포스팅은 <strong>KFQ</strong> 한국품질재단 인공지능 개발자 교육과정 1차 프로젝트의 발표 ppt 입니다.</p><p>저희 조의 주제는 <strong><span style="color:#F58224">코로나19</span></strong>에 따른 국내 <strong><span style="color:#F58224">영화산업</span></strong> 동향 및 전망 분석이었습니다.</p><iframe src="https://onedrive.live.com/embed?cid=ADFD1CC231D5D8DA&amp;resid=ADFD1CC231D5D8DA%218211&amp;authkey=ALqvmDMHPODEPgM&amp;em=2&amp;wdAr=1.7777777777777777" width="880px" height="518px" frameborder="0">포함된 <a target="_blank" href="https://office.com">Microsoft Office</a> 프레젠테이션, 제공: <a target="_blank" href="https://office.com/webapps">Office</a></iframe><hr /> <details> <summary>PPT 및 프로젝트 설명</summary><div><h2 id="section"><span class="mr-2">1. 프로젝트 개요</span><a href="#section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>코로나로 인해서 무너지고 있는 영화산업, 이에 대한 반등으로 증가하고 있는 국내 OTT 시장. 이러한 뉴스를 다들 접해 보셨을 거라 생각한다.</p><p>저희 조는 이러한 뉴스에서 아이디어를 얻어서 프로젝트 주제를 잡고, 다양한 분석 방법을 통해 국내 영화 산업이 나아가야할 방향성 등의 인사이트를 도출하고자 했다.</p><h2 id="section-1"><span class="mr-2">2. 프로젝트 요약 및 환경</span><a href="#section-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>저희는 간트차트에서 확인할 수 있듯이, 많은 데이터 테이블을 사용하여, 주제선정 이후 데이터 수집과 EDA, 전처리에서 많은 시간을 사용했다.</p><p>분석과 학습 등의 과정은 R에서 진행하였고, 국내통계 사이트 등의 OpenAPI를 Json 형식으로 크롤링, 핸들링할 때에는 파이썬을 같이 사용했다.</p><h2 id="section-2"><span class="mr-2">3. 진행과정 및 산출물</span><a href="#section-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>수집하고 실제 사용한 데이터는 총 6가지이다.</p><ol><li>영화 관람객 수 데이터<ul><li>일별 총 관객수 및 매출액<li>사용변수: 전체 상영 영화 수, 전국 스크린 수, 전체 관람객 수 등<li>변수 정제: 변수형 변경 (Char 변수 &gt; 수치형 변수)<li>시각화: 국내/해외/전체영화, 코로나 전/후<li>이상치: box-cox 변환<li>출처: KOFIC KOBIS 영화관 입장권 통합 전산망<blockquote><p>코로나 이전과 이후 관람객 수 변화, <code class="language-plaintext highlighter-rouge">토-일-수</code>의 순서로 관람객이 많은 것, 계절에 대한 패턴이 존재하는 것 등을 시각화 자료에서 확인 할 수 있다.</p></blockquote></ul><li>코로나 관련 데이터<ul><li>결측치: 뉴스 기사와 비교 후 수기 작성<li>사용변수: 신규/누적 확진자 수, 신규/누적 사망자 수, 치료 중 환자 수 등<li>변수 정제: 신규 인원에 관한 파생 변수 생성, 치료 중 환자 수 &gt; 생존한 치료 중 환자 수<li>출처: 공공데이터포털 보건복지부 코로나19 감염현황 조회서비스 Open API</ul><li>영화 검색량<ul><li>사용변수: 수집기간 기준 top100 영화명을 바탕으로 ‘영화’ 키워드 검색량<li>출처: Naver DataLab 통합 검색어 트렌드 API<blockquote><p>인기 상영작의 개봉, 수상 전후로 관람객 수가 급증하는 것을 시각화 자료에서 확인 할 수 있다.</p></blockquote></ul><li>날씨<ul><li>결측치: 강수량/적설량은 0, 기온 및 습도 결측치는 제거<li>사용변수: 최고/최저/평균 기온, 평균 강수량, 평균/최고 풍속, 평균 습도, 평균 적설량 등<li>변수 정제: 일별 불쾌지수 파생변수 추가, 지역별로 구분된 데이터 <code class="language-plaintext highlighter-rouge">group by</code>로 일자별로 평균값 사용<li>출처: 기상청 지상 (종관, ASOS) 일자료 조회서비스 Open API</ul><li>미세먼지<ul><li>결측치: 평균값으로 대체<li>사용변수: 미세먼지농도<li>변수 정제: 지역별로 구분된 데이터 <code class="language-plaintext highlighter-rouge">group by</code>로 일자별로 평균값 사용</ul><li>공휴일<ul><li>사용변수: 공휴일 날짜<li>변수정제: 주말/공휴일을 묶어 휴일, 나머지 평일로 범주형 변수 추가</ul></ol><p>시간의 흐름에 따른 시각화 자료에서, 코로나 관련 변수들에 있어서는 확실하게 관람객수가 감소한 모습을 볼수 있다.</p><h2 id="section-3"><span class="mr-2">4. 모델 검증 및 분석</span><a href="#section-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>분석에 앞서 각 변수들의 상관관계 그래프에서 유의미한 변수들을 확인하고</p><p>산점도 그래프를 통해 선형회귀분석을 진행하기로 하였다.</p><p>모델링에 앞서, 전처리과정에서 정규성을 만족하지 못하는 전체 관람객 수에 대하여 box-cox 변환을 진행했다.</p><p>변환 이후 정규화가 된 것과 이상치가 제거된 모습을 확인 할 수 있다.</p><p>4가지 범주형 변수에 대하여 등분산성 검정을 진행하고, 등분산성을 만족치 못하는 변수에 대해</p><p>추가로 welch t 검정을 통해, 평균에는 차이가 존재하여 통계적으로 유의미한 변수라 판단했다.</p><p>Anova 검정을 통해 유의미한 변수들의 판단과 함께 각 변수들의 교호관계도 확인했다.</p><p>해당 변수들로 선형 회귀를 진행하였을 때 81%의 설명력이 나왔지만, 변수가 너무 많아 발생하는 차원문제를 해결하기 위해서</p><p>best subset, 전진선택법, 후진소거법, 단계적 선택법의 4가지 변수 선택법을 모두 진행하였고 모두 동일한 8개의 변수를 선택하였다.</p><p>선택된 변수를 사용한 선형 회귀 모델에서 설명력 80%, 다중공선성에 문제 없음을 확인하였고</p><p>추가로 이상치를 제거하여 설명력을 83%까지 올렸다.</p><p>x 변수들을 scaling 하였을 때, 변수를 많이 선택할 수록 오차율이 낮아지는 것을 볼 수 있었지만, 차원 문제로 8개의 변수를 선택하였고, 이 역시 동일한 결론을 얻었다.</p><p>하지만 해당 모델의 완성 후, durbin watson 검정을 통해 독립성이 만족하지 않는 것을 발견, 이를 보완하기 위한 비선형 모델과 시계열 모델을 추가로 고려했다.</p><p>비선형 모델 중, 비선형 데이터에 적합하며, 오버피팅과 다중공선성을 방지 할 수 있고, 변수 중요도를 파악할 수 있는 장점에서 랜덤포레스트 모델을 사용했다.</p><p>최적의 결과를 확인하였을 때, 치료 중 환자 수가 학습에 있어서 가장 중요한 변수로 파악되었고, 시각화 자료에서 확인 할 수 있듯이, 대유행 시기에 맞춰 급증하는 치료 중 환자 수와 함께 급감하는 관람객 수를 볼 수 있다.</p><p>시계열 분석을 통해 경향성, 계절성을 분리시킨 이동평균 모델, 자기상관함수 확인을 통한 자기회귀모델에서 유의 수준 이상의 p 값 확인을 통해 시계열 arima 모델을 생성했다.</p><p>3개월, 6개월, 12개월, 24개월에 대한 예측 그래프와 함께 예측된 2021년 5월의 평균 관객 92458명, 실제 평균관객 141230명에서 box-cox 정규화 이후 4.875%의 상대오차로 예측이 완료되었다.</p><p>해당 오차의 차이는, 분노의 질주, 크루엘라 등 인기 개봉작에 의한 관객수 영향과 코로나 백신의 접종이 진행되며 일어난 것으로 파악 중이다.</p><h2 id="section-4"><span class="mr-2">5. 결론</span><a href="#section-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>랜덤 포레스트 모델로부터 치료 중 환자 수가 영화 관객 수 예측에 있어서 압도적으로 중요한 변수라는 것과 함께</p><p>시계열 모델로 계절성과 트렌드에 민감한 향후 2년간의 관객 수를 예측했다.</p><p>앞서 독립성을 만족하지 못하여, 분석의 의미가 퇴색된 선형회귀모델과 앙상블하여 더 뛰어난 모델을 생성할 경우 더욱 뛰어난 예측이 가능할 것으로 보이며</p><p>백신의 접종이 꾸준히 진행 되고 있기에, 관람객 수가 회복되기까지 국내 영화산업계가 조금만 더 버텨준다면, 이전 수준으로 회복하여 다시 빛을 볼 수 있을 것으로 예상된다.</p></div></details><hr /> <details> <summary>보고서</summary><div> <iframe src="https://onedrive.live.com/embed?cid=ADFD1CC231D5D8DA&amp;resid=ADFD1CC231D5D8DA%218221&amp;authkey=ADFjC4l0eS9OO_I&amp;em=2&amp;wdEmbedCode=0&amp;wdPrint=0" width="880px" height="1040px" frameborder="0">포함된 <a target="_blank" href="https://office.com">Microsoft Office</a> 문서, 제공: <a target="_blank" href="https://office.com/webapps">Office</a></iframe></div></details><hr /><h2 id="느낀점"><span class="mr-2">느낀점</span><a href="#느낀점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>협업에서의 양식 통일의 필요성을 느꼈다.</p><p>또한 소스 코드 업데이트 시, 기록이 남아있지 않아 좀 애먹었다. (사실 아직도 애먹고있다. 나중에 다시봐도 뭔말인지 읽기 힘들정도)</p><p>덕분에 Git을 사용해야겠다는 생각을 시작하였고, 흐르고 흘러 블로그까지 만들 수 있었다.</p><hr /><p><strong>프로젝트 진행 기간</strong></p><ul><li>2021년 5월 7일 금요일 ~ 6월 7일 월요일</ul><hr /> <details> <summary>R 전체 코드 (주의, 좀 김, 정리가 안되어있음..)</summary><div><div class="language-r highlighter-rouge"><div class="code-header"> <span data-label-text="R"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
</pre><td class="rouge-code"><pre><span class="c1"># setting</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">ls</span><span class="p">())</span><span class="w">
</span><span class="n">getwd</span><span class="p">()</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s1">'C:/Users/eric3/Desktop/example/large'</span><span class="p">)</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"C:\\19tak\\ai 개발자 과정\\prj1\\data"</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggpubr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rstatix</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">onewaytests</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gganimate</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">

</span><span class="n">options</span><span class="p">(</span><span class="n">warn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1"># Start</span><span class="w">
</span><span class="c1"># 열 재조정</span><span class="w">
</span><span class="c1"># 일단은 전체 데이터에 대해서만</span><span class="w">
</span><span class="n">all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s1">'all_final2.csv'</span><span class="p">)</span><span class="w">
</span><span class="n">all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span><span class="w">
</span><span class="n">all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">log_pm</span><span class="p">),</span><span class="w">
         </span><span class="n">Date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">Date</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">log_pm</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">26</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">2</span><span class="o">:</span><span class="m">11</span><span class="p">,</span><span class="m">27</span><span class="p">,</span><span class="m">12</span><span class="o">:</span><span class="m">27</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">research_volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">

</span><span class="c1"># 미세먼지 </span><span class="w">
</span><span class="c1"># 1. exp 취하기</span><span class="w">
</span><span class="c1"># 2. 범주 만들기</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">all</span><span class="p">)</span><span class="w">
      
</span><span class="c1">## 전체 영화에 대한 분석 ## (all)</span><span class="w">
</span><span class="c1">### EDA ###</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1. 결측치 확인 : 무</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">all</span><span class="p">))</span><span class="w">

</span><span class="c1">### 2. 이상치 확인</span><span class="w">
</span><span class="n">all_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="n">covid</span><span class="p">,</span><span class="n">weekdays</span><span class="p">,</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="n">d_index</span><span class="p">))</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_num</span><span class="p">)</span><span class="w">

</span><span class="c1"># u+- 3sigma 밖은 이상치로 판단</span><span class="w">
</span><span class="n">rm_outlier</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">mu</span><span class="m">-3</span><span class="o">*</span><span class="n">sigma</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mu</span><span class="m">+3</span><span class="o">*</span><span class="n">sigma</span><span class="p">){</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="s1">'no outlier'</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="p">{</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">    
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">apply</span><span class="p">(</span><span class="n">all_num</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">rm_outlier</span><span class="p">)</span><span class="w">
</span><span class="c1"># 이상치 없음을 확인</span><span class="w">

</span><span class="c1"># 상관관계 시각화</span><span class="w">
</span><span class="n">cor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">d_index</span><span class="p">,</span><span class="w"> </span><span class="n">deathCnt</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">cor</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="c1"># 유의성 matrix</span><span class="w">
</span><span class="n">cor.mtest</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="w"> </span><span class="n">conf.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ncol</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="w">
  </span><span class="n">p.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lowCI.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">uppCI.mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
  </span><span class="n">diag</span><span class="p">(</span><span class="n">p.mat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="n">diag</span><span class="p">(</span><span class="n">lowCI.mat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diag</span><span class="p">(</span><span class="n">uppCI.mat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor.test</span><span class="p">(</span><span class="n">mat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">mat</span><span class="p">[,</span><span class="w"> </span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">conf.level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.level</span><span class="p">)</span><span class="w">
      </span><span class="n">p.mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p.mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">p.value</span><span class="w">
      </span><span class="n">lowCI.mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lowCI.mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">conf.int</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
      </span><span class="n">uppCI.mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">uppCI.mat</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tmp</span><span class="o">$</span><span class="n">conf.int</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">p.mat</span><span class="p">,</span><span class="w"> </span><span class="n">lowCI.mat</span><span class="p">,</span><span class="w"> </span><span class="n">uppCI.mat</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">res1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor.mtest</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span><span class="w">

</span><span class="c1">## 유의수준에 따라 유의하지 않은 경우 X 표시하기</span><span class="w">
</span><span class="n">corrplot.mixed</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span><span class="n">lower</span><span class="o">=</span><span class="s2">"color"</span><span class="p">,</span><span class="n">upper</span><span class="o">=</span><span class="s2">"number"</span><span class="p">,</span><span class="n">p.mat</span><span class="o">=</span><span class="n">res1</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span><span class="n">sig.level</span><span class="o">=</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="n">tl.cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">tl.col</span><span class="o">=</span><span class="w"> </span><span class="s1">'blue'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="n">cor</span><span class="p">[</span><span class="m">1</span><span class="p">,])</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">l</span><span class="p">){</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">l</span><span class="p">)</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">next</span><span class="w">
    </span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="m">11</span><span class="o">-</span><span class="n">j</span><span class="m">+1</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="n">res1</span><span class="p">[[</span><span class="m">1</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="m">2</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># 산점도 파악</span><span class="w">
</span><span class="n">panel.cor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">cex.cor</span><span class="o">=</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">usr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">par</span><span class="p">(</span><span class="s2">"usr"</span><span class="p">);</span><span class="w"> </span><span class="nf">on.exit</span><span class="p">(</span><span class="n">par</span><span class="p">(</span><span class="n">usr</span><span class="p">))</span><span class="w">
  </span><span class="n">par</span><span class="p">(</span><span class="n">usr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
  </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
  </span><span class="n">txt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="m">0.123456789</span><span class="p">),</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digits</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">txt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="n">txt</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">missing</span><span class="p">(</span><span class="n">cex.cor</span><span class="p">))</span><span class="w"> 
    </span><span class="n">cex.cor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.8</span><span class="o">/</span><span class="n">strwidth</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="w">
  </span><span class="n">text</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">txt</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cex.cor</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># 수치형 변수에 대해서만</span><span class="w">
</span><span class="n">pairs</span><span class="p">(</span><span class="n">all_num</span><span class="p">,</span><span class="w"> </span><span class="n">lower.panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">panel.cor</span><span class="p">,</span><span class="w"> </span><span class="n">upper.panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">panel.smooth</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all2</span><span class="p">)</span><span class="w">

</span><span class="c1">#####################################</span><span class="w">
</span><span class="c1"># Visualization</span><span class="w">
</span><span class="c1"># all2 : 연도/월/일로 분할 해보기</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">all2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">Date</span><span class="p">),</span><span class="w">
                      </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="p">(</span><span class="n">Date</span><span class="p">),</span><span class="w">
                      </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">day</span><span class="p">(</span><span class="n">Date</span><span class="p">))</span><span class="w">

</span><span class="c1"># 시간이 지남에 따른 최고 풍속과 관객수간의 관계</span><span class="w">
</span><span class="n">hwind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covid</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"평균적인 최고 풍속"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"관객수"</span><span class="p">)</span><span class="w">
</span><span class="n">hwind</span><span class="w">
</span><span class="n">hwind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transition_time</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year: {frame_time}"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'sine-in-out'</span><span class="p">)</span><span class="w">

</span><span class="c1"># 치료중인 확진자 수과 관객수간의 관계</span><span class="w">
</span><span class="n">care</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">careCnt</span><span class="p">,</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covid</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"치료중인 확진자 수 "</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"관객수"</span><span class="p">)</span><span class="w">
</span><span class="n">care</span><span class="w">
</span><span class="n">care</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transition_time</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year: {frame_time}"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'sine-in-out'</span><span class="p">)</span><span class="w">

</span><span class="c1"># 누적 확진자 수과 관객수간의 관계</span><span class="w">
</span><span class="n">cumu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">decideCnt</span><span class="p">,</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covid</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"누적 확진자 수 "</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"관객수"</span><span class="p">)</span><span class="w">
</span><span class="n">cumu</span><span class="w">
</span><span class="n">cumu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transition_time</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year: {frame_time}"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'sine-in-out'</span><span class="p">)</span><span class="w">

</span><span class="c1"># 신규 확진자 수와 관객수 간의 관계</span><span class="w">
</span><span class="n">new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">newCnt</span><span class="p">,</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covid</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"신규 확진자 수 "</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"관객수"</span><span class="p">)</span><span class="w">
</span><span class="n">new</span><span class="w">
</span><span class="n">new</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transition_time</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year: {frame_time}"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'sine-in-out'</span><span class="p">)</span><span class="w">

</span><span class="c1"># research volume</span><span class="w">
</span><span class="n">research</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">research_volume</span><span class="p">,</span><span class="w"> </span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">covid</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"검색량"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"관객수"</span><span class="p">)</span><span class="w">
</span><span class="n">research</span><span class="w">
</span><span class="n">research</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transition_time</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year: {frame_time}"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'sine-in-out'</span><span class="p">)</span><span class="w">

</span><span class="c1"># 최고 풍속과 관객 수</span><span class="w">
</span><span class="c1">## 미세먼지에는 영향을 받는것 같진 않다</span><span class="w">
</span><span class="c1"># 미세먼지 범주 추가해서 봐보자</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">all2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="w">
</span><span class="n">p</span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">covid</span><span class="o">~</span><span class="n">weekdays_kind</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_d</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"inferno"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 불쾌지수도 딱히</span><span class="w">
</span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">all2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">a_aud</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="w"> </span><span class="n">d_index</span><span class="p">))</span><span class="w">
</span><span class="n">p1</span><span class="o">+</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">covid</span><span class="o">~</span><span class="n">weekdays_kind</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_d</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"inferno"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 신규확진자 수와 관객 수</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">all2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">newCnt</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">a_aud</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="w"> </span><span class="n">pm</span><span class="p">))</span><span class="w">
</span><span class="n">p2</span><span class="o">+</span><span class="n">facet_grid</span><span class="p">(</span><span class="n">covid</span><span class="o">~</span><span class="n">weekdays_kind</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_colour_viridis_d</span><span class="p">(</span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"inferno"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 뚜렷한 경향성을 보이는 변수는 찾지 못함</span><span class="w">

</span><span class="c1">################# 월 단위 ############</span><span class="w">
</span><span class="c1"># 18/19/20/21년 월 단위 평균 관객 수</span><span class="w">
</span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2020</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">

</span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2020</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w">

</span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">all_2_2018</span><span class="p">,</span><span class="n">all_2_2019</span><span class="p">,</span><span class="n">all_2_2020</span><span class="p">,</span><span class="n">all_2_2021</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="w">
</span><span class="n">month</span><span class="w">

</span><span class="c1"># </span><span class="w">
</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">mean_audience</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'identity'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w">
</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">+</span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="o">+</span><span class="w"> 
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">'월별 평균 관객 수'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'blue'</span><span class="p">,</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s1">'blue'</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">c</span><span class="w">
</span><span class="c1"># animation </span><span class="w">
</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="n">transition_states</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w">  </span><span class="n">state_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">transition_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'quintic-in'</span><span class="p">)</span><span class="w">

</span><span class="c1">################# 요일 단위 ############</span><span class="w">
</span><span class="c1"># 18/19/20/21년 요일 단위 평균 관객 수</span><span class="w">
</span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2020</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">

</span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2018</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2018</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2019</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2020</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2020</span><span class="p">)</span><span class="w">
</span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_2_2021</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2021</span><span class="p">)</span><span class="w">

</span><span class="n">weekdays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">all_2_2018</span><span class="p">,</span><span class="n">all_2_2019</span><span class="p">,</span><span class="n">all_2_2020</span><span class="p">,</span><span class="n">all_2_2021</span><span class="p">)</span><span class="w">

</span><span class="c1"># </span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weekdays</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">mean_audience</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'identity'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'Fri'</span><span class="p">,</span><span class="s1">'Mon'</span><span class="p">,</span><span class="s1">'Sat'</span><span class="p">,</span><span class="s1">'Sun'</span><span class="p">,</span><span class="s1">'Thu'</span><span class="p">,</span><span class="s1">'Tue'</span><span class="p">,</span><span class="s1">'Wed'</span><span class="p">))</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="o">+</span><span class="w"> 
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s1">'요일별 평균 관객 수'</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'blue'</span><span class="p">,</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s1">'blue'</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">d</span><span class="w">

</span><span class="c1"># animation </span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="n">transition_states</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w">  </span><span class="n">state_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">transition_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ease_aes</span><span class="p">(</span><span class="s1">'quintic-in'</span><span class="p">)</span><span class="w">

</span><span class="c1"># EDA 과정에서 통계적 분석</span><span class="w">
</span><span class="c1">###### statistical test #####</span><span class="w">
</span><span class="c1">### one-way anova</span><span class="w">
</span><span class="c1"># 모집단의 분산이 다를 때 표본의 평균차이를 검정하는 Welch Test 확인</span><span class="w">
</span><span class="c1"># p-value가 작다? : 등분산성 만족하지 않음</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">welch.test</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">welch.test</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">welch.test</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">d_index</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="p">)</span><span class="w"> </span><span class="c1"># 등분산 만족</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">d_index</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all</span><span class="p">))</span><span class="w"> </span><span class="c1"># 평균간 차이가 없다!</span><span class="w">
</span><span class="c1"># y를 scaling해보고 시도해보자</span><span class="w">
</span><span class="c1">## box-cox 변환</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">all</span><span class="o">$</span><span class="n">a_aud</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">all</span><span class="o">$</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">boxCox</span><span class="p">(</span><span class="n">all</span><span class="o">$</span><span class="n">a_aud</span><span class="o">~</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boxCox</span><span class="p">(</span><span class="n">all</span><span class="o">$</span><span class="n">a_aud</span><span class="o">~</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">a</span><span class="w">
</span><span class="n">which.max</span><span class="p">(</span><span class="n">a</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1"># 55 index</span><span class="w">
</span><span class="n">a</span><span class="o">$</span><span class="n">x</span><span class="p">[</span><span class="m">55</span><span class="p">]</span><span class="w">
</span><span class="n">all_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_aud</span><span class="o">^</span><span class="m">0.1818182-1</span><span class="p">)</span><span class="o">/</span><span class="m">0.1818182</span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">)</span><span class="w">
</span><span class="n">all_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_aud</span><span class="o">^</span><span class="m">0.1818182-1</span><span class="p">)</span><span class="o">/</span><span class="m">0.1818182</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w"> </span><span class="c1"># 얘만 등분산 만족하지 않음</span><span class="w">
</span><span class="n">bartlett.test</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">d_index</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">

</span><span class="c1"># 추가 test</span><span class="w">
</span><span class="n">welch.test</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">))</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">))</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">))</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">d_index</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">))</span><span class="w"> </span><span class="c1"># 혼자 중요하지 않네</span><span class="w">


</span><span class="c1"># weekdays는 그룹이 7개이기 때문에 multiple comparison 필요</span><span class="w">
</span><span class="n">attach</span><span class="p">(</span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">weekdays</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">weekdays</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mon"</span><span class="p">,</span><span class="s1">'tue'</span><span class="p">,</span><span class="s1">'wed'</span><span class="p">,</span><span class="s1">'thu'</span><span class="p">,</span><span class="s1">'fri'</span><span class="p">,</span><span class="s1">'sat'</span><span class="p">,</span><span class="s1">'sun'</span><span class="p">)</span><span class="w">
</span><span class="n">tapply</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="n">weekdays</span><span class="p">,</span><span class="n">mean</span><span class="p">)</span><span class="w">
</span><span class="n">tapply</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="n">weekdays</span><span class="p">,</span><span class="n">sd</span><span class="p">)</span><span class="w">

</span><span class="c1"># one way anova - multiple comparison 자주 사용되는 (holm : 본페르니보다 덜 보수적)</span><span class="w">
</span><span class="n">pairwise.t.test</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="s2">"bonferroni"</span><span class="p">)</span><span class="w">
</span><span class="n">pairwise.t.test</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="s2">"holm"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 결론 : 두 방법 모두 (월요일,금요일),(월요일과 일요일),(화요일과 금요일),(화요일과 토요일),(수요일과 목요일),(금요일과 토요일),(금요일과 일요일)은 모평균의 차이가 없다 </span><span class="w">
</span><span class="c1"># 차이가 있는 요일쌍은 (월,화) (월,수) (월,목) (월,토) (화,수) (화,목) (화,일) (수,금) (수,토) (수,일) (목,토) (목,금) (목,일) (토,일)</span><span class="w">
</span><span class="c1"># 오늘 영화관에 사람이 많다면, 언제가야 사람이 적을까에 대한 고찰 가능</span><span class="w">

</span><span class="c1">#1</span><span class="w">
</span><span class="c1"># covid &amp; 평일여부</span><span class="w">
</span><span class="n">interaction.plot</span><span class="p">(</span><span class="n">x.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">trace.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"covid"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">,</span><span class="w">
                 </span><span class="n">pch</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#00AFBB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E7B800"</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Covid &amp; 평일여부'</span><span class="p">,</span><span class="w">
                 </span><span class="n">trace.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"평일 여부"</span><span class="p">,</span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#2</span><span class="w">
</span><span class="c1"># covid &amp; 요일</span><span class="w">
</span><span class="n">interaction.plot</span><span class="p">(</span><span class="n">x.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">trace.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"covid"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">,</span><span class="w">
                 </span><span class="n">pch</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Covid &amp; 요일'</span><span class="p">,</span><span class="w">
                 </span><span class="n">trace.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"요일"</span><span class="p">,</span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="n">boxplot</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> 
        </span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'covid*요일'</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">)</span><span class="w">
</span><span class="c1">#3</span><span class="w">
</span><span class="c1"># 요일 &amp; 평일여부</span><span class="w">
</span><span class="n">interaction.plot</span><span class="p">(</span><span class="n">x.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">trace.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"요일"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">,</span><span class="w">
                 </span><span class="n">pch</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="o">:</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'요일 &amp; 평일여부'</span><span class="p">,</span><span class="w">
                 </span><span class="n">trace.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"평일 여부"</span><span class="p">,</span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#4</span><span class="w">
</span><span class="c1"># covid &amp; 미세먼지</span><span class="w">
</span><span class="n">all_box_pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">pm</span><span class="o">&lt;=</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="s1">'좋음'</span><span class="p">,</span><span class="w">
                                    </span><span class="n">ifelse</span><span class="p">(</span><span class="n">pm</span><span class="o">&lt;=</span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="s1">'보통'</span><span class="p">,</span><span class="w">
                                           </span><span class="n">ifelse</span><span class="p">(</span><span class="n">pm</span><span class="o">&lt;=</span><span class="m">150</span><span class="p">,</span><span class="s1">'나쁨'</span><span class="p">,</span><span class="s1">'매우나쁨'</span><span class="p">))))</span><span class="w">
</span><span class="c1"># 순서형 범주로 만들어야함</span><span class="w">
</span><span class="n">all_box_pm</span><span class="p">[,</span><span class="s2">"pm"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">all_box_pm</span><span class="p">[,</span><span class="w"> </span><span class="s2">"pm"</span><span class="p">],</span><span class="w"> </span><span class="n">ordered</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">all_box_pm</span><span class="o">$</span><span class="n">pm</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'좋음'</span><span class="p">,</span><span class="s1">'보통'</span><span class="p">,</span><span class="s1">'나쁨'</span><span class="p">,</span><span class="s1">'매우 나쁨'</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">all_box_pm</span><span class="o">$</span><span class="n">pm</span><span class="p">)</span><span class="w">
</span><span class="c1"># 미세먼지와 코로나 전후 변수 사이 교호작용 존재 X</span><span class="w">
</span><span class="n">all_box_pm</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggline</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"covid"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a_aud"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pm"</span><span class="p">,</span><span class="w">
                  </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"mean_se"</span><span class="p">),</span><span class="w">
                  </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#00AFBB"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#E7B800"</span><span class="p">,</span><span class="s1">'#FC4E07'</span><span class="p">,</span><span class="s1">'#GA3E07'</span><span class="p">))</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pm</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box_pm</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
        </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'covid*미세먼지'</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">)</span><span class="w">
</span><span class="c1">#5 평일여부 &amp; 미세먼지</span><span class="w">
</span><span class="n">interaction.plot</span><span class="p">(</span><span class="n">x.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">trace.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="o">$</span><span class="n">pm</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"평일 여부"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">,</span><span class="w">
                 </span><span class="n">pch</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'미세먼지 &amp; 평일여부'</span><span class="p">,</span><span class="w">
                 </span><span class="n">trace.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"미세먼지 정도"</span><span class="p">,</span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">#6 요일 &amp; 미세먼지</span><span class="w">
</span><span class="n">interaction.plot</span><span class="p">(</span><span class="n">x.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">trace.factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="o">$</span><span class="n">pm</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"요일"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"영화관객 수"</span><span class="p">,</span><span class="w">
                 </span><span class="n">pch</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'미세먼지 &amp; 요일'</span><span class="p">,</span><span class="w">
                 </span><span class="n">trace.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"미세먼지 정도"</span><span class="p">,</span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="c1">## two way anova test</span><span class="w">
</span><span class="c1">#1</span><span class="w">
</span><span class="n">aov1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">covid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="o">*</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov1</span><span class="p">)</span><span class="w"> 
</span><span class="c1">#2</span><span class="w">
</span><span class="n">aov2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">covid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays</span><span class="o">*</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov2</span><span class="p">)</span><span class="w">
</span><span class="c1">#3</span><span class="w">
</span><span class="n">aov3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">weekdays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays</span><span class="o">*</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov3</span><span class="p">)</span><span class="w">
</span><span class="c1">#4</span><span class="w">
</span><span class="n">aov4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">covid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pm</span><span class="o">*</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov4</span><span class="p">)</span><span class="w">
</span><span class="c1">#5</span><span class="w">
</span><span class="n">aov5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pm</span><span class="o">*</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov5</span><span class="p">)</span><span class="w">
</span><span class="c1">#6</span><span class="w">
</span><span class="n">aov6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pm</span><span class="o">*</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov6</span><span class="p">)</span><span class="w">
</span><span class="c1">#7</span><span class="w">
</span><span class="n">aov7</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="o">+</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box_pm</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov7</span><span class="p">)</span><span class="w">
</span><span class="c1"># 3-way anova</span><span class="w">
</span><span class="n">replications</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="o">*</span><span class="n">weekdays</span><span class="o">*</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">));</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">));</span><span class="w">
</span><span class="n">with</span><span class="p">(</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">weekdays</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">));</span><span class="w">
</span><span class="c1">#8</span><span class="w">
</span><span class="n">aov_v</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="o">*</span><span class="n">weekdays</span><span class="o">*</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">aov_v</span><span class="p">)</span><span class="w">
</span><span class="n">TukeyHSD</span><span class="p">(</span><span class="n">aov_v</span><span class="p">,</span><span class="w"> </span><span class="n">conf.level</span><span class="o">=</span><span class="m">.95</span><span class="p">)</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="s1">'contrasts'</span><span class="p">)</span><span class="w">
</span><span class="n">summary.lm</span><span class="p">(</span><span class="n">aov_v</span><span class="p">)</span><span class="w">

</span><span class="c1">### Modeling ###</span><span class="w">
</span><span class="n">all_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Date</span><span class="p">))</span><span class="w">
</span><span class="n">m3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span><span class="w"> </span><span class="c1"># 0.81 # 모든 변수포함</span><span class="w">
</span><span class="n">m4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">a_screen</span><span class="o">+</span><span class="n">covid</span><span class="o">+</span><span class="n">weekdays</span><span class="o">+</span><span class="n">weekdays_kind</span><span class="o">+</span><span class="n">covid</span><span class="o">*</span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">decideCnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">careCnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d_val</span><span class="w"> </span><span class="p">,</span><span class="w">
        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w"> </span><span class="c1"># 상호작용 텀 추가 : 0.805</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">m4</span><span class="p">)</span><span class="w">
</span><span class="n">m5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">a_screen</span><span class="o">+</span><span class="n">covid</span><span class="o">+</span><span class="n">weekdays</span><span class="o">+</span><span class="n">weekdays_kind</span><span class="o">+</span><span class="n">decideCnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">careCnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d_val</span><span class="w"> </span><span class="p">,</span><span class="w">
        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">m5</span><span class="p">)</span><span class="w">
</span><span class="n">m5</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">durbinWatsonTest</span><span class="p">()</span><span class="w">

</span><span class="c1"># 회귀 진단</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">m4</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">plot</span><span class="w">
</span><span class="n">m4</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="n">durbinWatsonTest</span><span class="p">()</span><span class="w">
</span><span class="n">m4</span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">residuals</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">durbinWatsonTest</span><span class="p">()</span><span class="w"> </span><span class="c1"># 독립성 위반  # -&gt; 시계열모형 고려를 해야한다.</span><span class="w">
</span><span class="n">m4</span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">residuals</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">shapiro.test</span><span class="p">()</span><span class="w"> </span><span class="c1"># 정규성 만족</span><span class="w">
</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Date</span><span class="p">))</span><span class="w">
</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">a</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w">

</span><span class="c1"># 자기상관 모델</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">)</span><span class="w">
</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">acf</span><span class="p">(</span><span class="n">a</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'correlation'</span><span class="p">),</span><span class="n">plot</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">z</span><span class="o">$</span><span class="n">acf</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">

</span><span class="c1"># User Defined Function of Autocorrelation</span><span class="w">
</span><span class="n">acf_func</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lag_k</span><span class="p">){</span><span class="w">
  </span><span class="c1"># y: input vector</span><span class="w">
  </span><span class="c1"># lag_k : Lag order of k</span><span class="w">
  </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c1"># total number of observations</span><span class="w">
  </span><span class="n">y_bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
  </span><span class="c1"># Variance</span><span class="w">
  </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_bar</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">N</span><span class="w">
  </span><span class="c1"># Autocovariance</span><span class="w">
  </span><span class="n">auto_cov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">((</span><span class="n">y</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">lag_k</span><span class="p">)]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_bar</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">[(</span><span class="m">1</span><span class="o">+</span><span class="n">lag_k</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y_bar</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">N</span><span class="w">
  </span><span class="c1"># Autocorrelation coefficient = Autocovariance / Variance</span><span class="w">
  </span><span class="n">r_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">auto_cov</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">var</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">r_k</span><span class="p">)</span><span class="w">  
</span><span class="p">}</span><span class="w">

</span><span class="n">acf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">()</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="m">-1</span><span class="p">)){</span><span class="w">  
  </span><span class="n">acf_k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">acf_func</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lag_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
  </span><span class="n">acf</span><span class="p">[</span><span class="n">k</span><span class="m">+1</span><span class="p">,</span><span class="w"> </span><span class="s1">'lag'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w">
  </span><span class="n">acf</span><span class="p">[</span><span class="n">k</span><span class="m">+1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ACF'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acf_k</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">acf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w">
</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
</span><span class="c1"># 1.96 / 루트(1096)</span><span class="w">
</span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">

</span><span class="c1"># 시계열 분석 #</span><span class="w">
</span><span class="n">all</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w">
</span><span class="n">before_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">covid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'before'</span><span class="p">)</span><span class="w">
</span><span class="n">before_c</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">after_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">covid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'after'</span><span class="p">)</span><span class="w">
</span><span class="n">after_c</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="p">()</span><span class="w">
</span><span class="n">plot.ts</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">before_c</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">before_c</span><span class="o">$</span><span class="n">a_aud</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'추세선'</span><span class="p">)</span><span class="w">
</span><span class="n">plot.ts</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">after_c</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">after_c</span><span class="o">$</span><span class="n">a_aud</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'추세선'</span><span class="p">)</span><span class="w">

</span><span class="c1"># 전처리 간단한</span><span class="w">
</span><span class="c1"># 시계열 .... y값만 가지고 y값을 예측한다 </span><span class="w">
</span><span class="c1"># y값만 이용</span><span class="w">
</span><span class="n">a</span><span class="o">$</span><span class="n">a_aud</span><span class="w">
</span><span class="n">all2</span><span class="o">$</span><span class="n">a_aud</span><span class="w">
</span><span class="c1"># 월마다 평균 (관객 수를 월마다 평균)</span><span class="w">
</span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w">
</span><span class="n">all3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">nchar</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">==</span><span class="m">1</span><span class="p">,</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'two'</span><span class="p">))</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">all3</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">==</span><span class="s1">'one'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span><span class="n">month</span><span class="p">),</span><span class="w">
                                           </span><span class="n">ym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">))</span><span class="w"> 
</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">!=</span><span class="s1">'one'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">ym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">))</span><span class="w"> 
</span><span class="n">all3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># 2018년 5월 / 18년 6월 ... 21년 5월 .. 관객수의 평균</span><span class="w">
</span><span class="c1"># 2018 + 05 -&gt; 201805 .. 문자열 </span><span class="w">
</span><span class="n">all3</span><span class="w">
</span><span class="n">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">ym</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w"> 
</span><span class="n">ts</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ts</span><span class="o">$</span><span class="n">m</span><span class="w">
</span><span class="n">data</span><span class="w">

</span><span class="c1"># 시계열 자료형성</span><span class="w">
</span><span class="n">tsdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2018</span><span class="p">,</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">tsdata</span><span class="w">
</span><span class="c1"># 추세선 확인</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">ts.plot</span><span class="p">(</span><span class="n">tsdata</span><span class="p">)</span><span class="w">

</span><span class="c1"># 시계열 분해</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">stl</span><span class="p">(</span><span class="n">tsdata</span><span class="p">,</span><span class="w"> </span><span class="s1">'periodic'</span><span class="p">))</span><span class="w">

</span><span class="c1"># 변동 요인제거</span><span class="w">
</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">decompose</span><span class="p">(</span><span class="n">tsdata</span><span class="p">)</span><span class="w">
</span><span class="nf">attributes</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w">

</span><span class="c1"># 계절요인 제거 </span><span class="w">
</span><span class="n">rm_season</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tsdata</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="o">$</span><span class="n">seasonal</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rm_season</span><span class="p">)</span><span class="w">

</span><span class="c1"># 추세요인 제거</span><span class="w">
</span><span class="n">rm_trend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tsdata</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="o">$</span><span class="n">trend</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rm_trend</span><span class="p">)</span><span class="w">

</span><span class="c1"># 불규칙 요인만 확인</span><span class="w">
</span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">$</span><span class="n">random</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">random</span><span class="p">)</span><span class="w">

</span><span class="c1"># 자기상관 함수</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">tsdata</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">rm_season</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">rm_trend</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">acf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">

</span><span class="c1"># 부분 자기상관 함수</span><span class="w">
</span><span class="n">pacf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">tsdata</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">pacf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">rm_season</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">pacf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">rm_trend</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">
</span><span class="n">pacf</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'자기상관함수'</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s1">'red'</span><span class="p">))</span><span class="w">

</span><span class="c1"># 차분 시각화</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">tsdata</span><span class="p">,</span><span class="w"> </span><span class="n">differnces</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">rm_season</span><span class="p">,</span><span class="w"> </span><span class="n">differnces</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">ts.plot</span><span class="p">(</span><span class="n">tsdata</span><span class="p">)</span><span class="w">
</span><span class="n">diff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">diff</span><span class="p">(</span><span class="n">tsdata</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span><span class="w">
</span><span class="c1"># 시계열 모형 식별</span><span class="w">
</span><span class="n">ts_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">auto.arima</span><span class="p">(</span><span class="n">tsdata</span><span class="p">)</span><span class="w">
</span><span class="n">ts_model</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">arima</span><span class="p">(</span><span class="n">tsdata</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">seasonal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)))</span><span class="w">
</span><span class="n">model</span><span class="w">
</span><span class="n">tsdiag</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w">
</span><span class="c1"># 자기상관 없고, 규칙성 없음 </span><span class="w">
</span><span class="n">Box.test</span><span class="p">(</span><span class="n">model</span><span class="o">$</span><span class="n">residuals</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Ljung'</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">fore</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fore</span><span class="p">)</span><span class="w">
</span><span class="n">fore2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">fore2</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fore2</span><span class="p">)</span><span class="w">
</span><span class="n">fore3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">fore3</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fore3</span><span class="p">)</span><span class="w">
</span><span class="n">fore4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">forecast</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="o">=</span><span class="m">24</span><span class="p">)</span><span class="w">
</span><span class="n">fore4</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fore4</span><span class="p">)</span><span class="w">
</span><span class="n">fore</span><span class="w">
</span><span class="n">fore2</span><span class="w">
</span><span class="n">fore3</span><span class="w">
</span><span class="n">fore4</span><span class="w">

</span><span class="c1"># 이동평균법 vs 지수평활법</span><span class="w">
</span><span class="c1">#install.packages('TTR')</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">TTR</span><span class="p">)</span><span class="w">

</span><span class="c1">#####</span><span class="w">
</span><span class="c1"># graph #</span><span class="w">
</span><span class="c1">#####</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">leaps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">glmnet</span><span class="p">)</span><span class="w">
</span><span class="c1">########</span><span class="w">
</span><span class="c1"># 본격적인 모델링</span><span class="w">
</span><span class="c1"># best subset selection #</span><span class="w">
</span><span class="c1"># 요일 포함 bs - 0.79</span><span class="w">
</span><span class="c1"># 요일 포함하는게 나음</span><span class="w">
</span><span class="n">bs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">bs1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span><span class="w">
</span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="w">
</span><span class="n">bs1</span><span class="o">$</span><span class="n">bic</span><span class="w">
</span><span class="n">bs1</span><span class="o">$</span><span class="n">cp</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="m">5</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="m">8</span><span class="p">))[</span><span class="m">2</span><span class="o">:</span><span class="m">9</span><span class="p">]</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'AdjR2'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.max</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'rss'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.max</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">bs1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">cp</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'cp'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.min</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">cp</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">bs1</span><span class="o">$</span><span class="n">cp</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">bic</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'bic'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.min</span><span class="p">(</span><span class="n">bs1</span><span class="o">$</span><span class="n">bic</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">bs1</span><span class="o">$</span><span class="n">bic</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s1">'adjr2'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s1">'Cp'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s1">'bic'</span><span class="p">)</span><span class="w">

</span><span class="c1"># forward</span><span class="w">
</span><span class="n">fw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="w"> </span><span class="s1">'forward'</span><span class="p">)</span><span class="w">
</span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span><span class="w">
</span><span class="n">fs</span><span class="o">$</span><span class="n">adjr2</span><span class="w">
</span><span class="n">fs</span><span class="o">$</span><span class="n">bic</span><span class="w">
</span><span class="n">fs</span><span class="o">$</span><span class="n">cp</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fs</span><span class="o">$</span><span class="n">adjr2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'AdjR2'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.max</span><span class="p">(</span><span class="n">fs</span><span class="o">$</span><span class="n">adjr2</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="o">$</span><span class="n">adjr2</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span><span class="m">5</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># backward</span><span class="w">
</span><span class="n">bk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="w"> </span><span class="s1">'backward'</span><span class="p">)</span><span class="w">
</span><span class="n">bk1</span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">bk</span><span class="p">)</span><span class="w">
</span><span class="n">bk1</span><span class="o">$</span><span class="n">adjr2</span><span class="w">
</span><span class="n">bk1</span><span class="o">$</span><span class="n">bic</span><span class="w">
</span><span class="n">bk1</span><span class="o">$</span><span class="n">cp</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">bk1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'# of Variables'</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="s1">'AdjR2'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'l'</span><span class="p">)</span><span class="w">
</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which.max</span><span class="p">(</span><span class="n">bk1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">bk1</span><span class="o">$</span><span class="n">adjr2</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'red'</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span><span class="m">8</span><span class="p">)</span><span class="w">

</span><span class="c1"># stepwise</span><span class="w">
</span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="w"> </span><span class="s1">'seqrep'</span><span class="p">)</span><span class="w">
</span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">sw</span><span class="p">)</span><span class="w">
</span><span class="n">ss</span><span class="o">$</span><span class="n">adjr2</span><span class="w">
</span><span class="n">ss</span><span class="o">$</span><span class="n">bic</span><span class="w">
</span><span class="n">ss</span><span class="o">$</span><span class="n">cp</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">bk</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">sw</span><span class="p">,</span><span class="m">8</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1"># 모두 동일</span><span class="w">

</span><span class="c1"># 회귀 진단 </span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="o">+</span><span class="n">a_screen</span><span class="o">+</span><span class="n">weekdays</span><span class="o">+</span><span class="n">weekdays_kind</span><span class="o">+</span><span class="n">decideCnt</span><span class="o">+</span><span class="n">careCnt</span><span class="o">+</span><span class="n">d_val</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="c1"># 설명력 80.1퍼</span><span class="w">
</span><span class="c1"># vif check</span><span class="w">
</span><span class="n">vif</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">)</span><span class="w">

</span><span class="c1"># cook's distance</span><span class="w">
</span><span class="n">cooks.distance</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="n">cooks.distance</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># 0개의 influential point</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">rstudent</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="c1"># 1096개</span><span class="w">

</span><span class="c1"># 표준잔차 &gt;2 : 이상치라고 판단 (선형회귀분석에 있어서)</span><span class="w">
</span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rstudent</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="n">rstudent</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">&gt;</span><span class="m">2</span><span class="p">]</span><span class="w"> 
</span><span class="nf">length</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span><span class="w">  </span><span class="c1"># 길이 : 31</span><span class="w">
</span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">aa</span><span class="p">))</span><span class="w">
</span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="w">

</span><span class="c1"># 이상치 제거</span><span class="w">
</span><span class="n">all_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">[</span><span class="o">-</span><span class="n">idx</span><span class="p">,]</span><span class="w">

</span><span class="c1"># 확인차</span><span class="w">
</span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">covid</span><span class="o">+</span><span class="n">a_screen</span><span class="o">+</span><span class="n">weekdays</span><span class="o">+</span><span class="n">weekdays_kind</span><span class="o">+</span><span class="n">decideCnt</span><span class="o">+</span><span class="n">careCnt</span><span class="o">+</span><span class="n">d_val</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">
</span><span class="n">vif</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">

</span><span class="c1"># 0.83의 설명력</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w"> </span><span class="c1"># good fitting</span><span class="w">

</span><span class="c1"># 모델 검증</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">all_box</span><span class="p">)</span><span class="w"> </span><span class="c1"># 31개 항 제거</span><span class="w">

</span><span class="c1"># train_test split</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">caTools</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">train_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample.split</span><span class="p">(</span><span class="n">all_box</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">SplitRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">[</span><span class="n">train_idx</span><span class="p">,]</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="p">[</span><span class="n">train_idx</span><span class="o">==</span><span class="nb">F</span><span class="p">,]</span><span class="w">

</span><span class="c1"># check</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">all_box</span><span class="p">)</span><span class="w"> </span><span class="c1">#1065</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="w"> </span><span class="c1">#852</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="c1">#213</span><span class="w">

</span><span class="c1"># x,y split</span><span class="w">
</span><span class="n">y_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">y_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">predict</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'confidence'</span><span class="p">)</span><span class="w">
</span><span class="n">base_yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">base_yhat</span><span class="w">

</span><span class="c1"># test mse function</span><span class="w">
</span><span class="n">test_mse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">true_y</span><span class="p">,</span><span class="w"> </span><span class="n">yhat</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">((</span><span class="n">true_y</span><span class="o">-</span><span class="n">yhat</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># baseline : 변수 선택없이 회귀 # 18.10643</span><span class="w">
</span><span class="n">test_mse</span><span class="p">(</span><span class="n">base_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">y_test</span><span class="p">)</span><span class="w">
</span><span class="n">test_mse</span><span class="p">(</span><span class="n">base_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">y_test</span><span class="p">)</span><span class="w">

</span><span class="c1"># 변수선택한 회귀</span><span class="w">
</span><span class="c1"># 변수를 몇개 선택해야할까?</span><span class="w">
</span><span class="n">predict.regsubsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="n">newdata</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="n">...</span><span class="p">){</span><span class="w">
  </span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">object</span><span class="o">$</span><span class="n">call</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span><span class="w"> </span><span class="c1"># object은 regsubsets() object</span><span class="w">
  </span><span class="n">mat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model.matrix</span><span class="p">(</span><span class="n">form</span><span class="p">,</span><span class="n">newdata</span><span class="p">)</span><span class="w"> </span><span class="c1"># model.matrix(model fit한 formula, data)</span><span class="w">
  </span><span class="n">coefi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="c1"># regsubsets() 결과에서 var이 ~개일 때의 coef 저장하기</span><span class="w">
  </span><span class="n">xvars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">coefi</span><span class="p">)</span><span class="w"> </span><span class="c1"># coefi 칼럼명 뽑아내기</span><span class="w">
  </span><span class="n">mat</span><span class="p">[,</span><span class="n">xvars</span><span class="p">]</span><span class="o">%*%</span><span class="n">coefi</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nvmax</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">val.error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">19</span><span class="p">){</span><span class="w">
  </span><span class="n">yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict.regsubsets</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
  </span><span class="n">val.error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_mse</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">yhat</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">which.min</span><span class="p">(</span><span class="n">val.error</span><span class="p">)</span><span class="w">
</span><span class="n">val.error</span><span class="w"> </span><span class="c1"># MSE</span><span class="w">
</span><span class="c1"># 계속 줄어드는 양상... but 차원까지 생각해서</span><span class="w">
</span><span class="c1"># id = 19, 15.70039 최저 ... id=5 , 22.03  / id=12, 16.63519</span><span class="w">

</span><span class="c1"># y 변수 : box-cox</span><span class="w">
</span><span class="c1"># x 변수 : 어떠한 변환도 없음</span><span class="w">
</span><span class="c1"># 이 이후부터</span><span class="w">
</span><span class="c1">## x 변수에 scaling 적용한다면?</span><span class="w">
</span><span class="c1"># standardscaling</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="w">
</span><span class="c1"># all_box2 : x변수 스케일링, y변수 box cox O</span><span class="w">
</span><span class="c1"># all_box : x변수 스케일링 X, y변수 box cox O</span><span class="w">

</span><span class="c1"># scaling 한 df 를 따로 만들기</span><span class="w">
</span><span class="n">all_box2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">all_box2</span><span class="p">)){</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'covid'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'weekdays'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> 
      </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'weekdays_kind'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'d_index'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'a_aud'</span><span class="p">){</span><span class="w">
    </span><span class="n">all_box2</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span><span class="w">
    </span><span class="n">all_box2</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">all_box2</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_box2</span><span class="p">)</span><span class="w">

</span><span class="c1"># 다시 스플릿</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">train_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample.split</span><span class="p">(</span><span class="n">all_box2</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">SplitRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box2</span><span class="p">[</span><span class="n">train_idx</span><span class="p">,]</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box2</span><span class="p">[</span><span class="n">train_idx</span><span class="o">==</span><span class="nb">F</span><span class="p">,]</span><span class="w">

</span><span class="c1"># check</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">all_box2</span><span class="p">)</span><span class="w"> </span><span class="c1">#1065</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="w"> </span><span class="c1">#852</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="c1">#213</span><span class="w">

</span><span class="c1"># x,y split</span><span class="w">
</span><span class="n">y_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">y_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regsubsets</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_box2</span><span class="p">,</span><span class="w"> </span><span class="n">nbest</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nvmax</span><span class="o">=</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="n">val.error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">19</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">19</span><span class="p">){</span><span class="w">
  </span><span class="n">yhat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict.regsubsets</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
  </span><span class="n">val.error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_mse</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">yhat</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">which.min</span><span class="p">(</span><span class="n">val.error</span><span class="p">)</span><span class="w">
</span><span class="n">val.error</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="m">5</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="m">5</span><span class="p">),</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="c1"># 달라지지 않음 # 어차피 예측값도 같고, coef도 같아서!</span><span class="w">
</span><span class="c1"># all_box로 해도 되고 all_box2로 해도 됨</span><span class="w">
</span><span class="c1">#################################</span><span class="w">
</span><span class="c1"># cv </span><span class="w">
</span><span class="c1"># Ridge, Lasso 돌리려면 더미변수로 만들어야한다</span><span class="w">
</span><span class="c1"># cv 돌리기 전</span><span class="w">
</span><span class="c1"># all_box = 더미 변수 만들기 전</span><span class="w">
</span><span class="c1"># all_new2 = 더미변수 만든 후</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_box</span><span class="p">)</span><span class="w">
</span><span class="n">all_dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_box</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'on'</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w">
                               </span><span class="n">weekdays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Sunday'</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="w">
                                                 </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Monday'</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w">
                                                        </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Tuesday'</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="w">
                                                               </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Wednesday'</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="w">
                                                                      </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Thursday'</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="w">
                                                                             </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Friday'</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)))))),</span><span class="w">
                               
                                   </span><span class="n">d_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">d_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'comfy'</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
                               
                                   </span><span class="n">covid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">covid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'후'</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w"> 
</span><span class="n">table</span><span class="p">(</span><span class="n">all_dummy</span><span class="o">$</span><span class="n">weekdays</span><span class="p">)</span><span class="w">

</span><span class="c1"># Re - split</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">train_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sample.split</span><span class="p">(</span><span class="n">all_dummy</span><span class="o">$</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">SplitRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_dummy</span><span class="p">[</span><span class="n">train_idx</span><span class="p">,]</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_dummy</span><span class="p">[</span><span class="n">train_idx</span><span class="o">==</span><span class="nb">F</span><span class="p">,]</span><span class="w">

</span><span class="c1"># check</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">all_dummy</span><span class="p">)</span><span class="w"> </span><span class="c1">#1065</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="w"> </span><span class="c1">#852</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="c1">#213</span><span class="w">

</span><span class="c1"># x,y split</span><span class="w">
</span><span class="n">y_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">y_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'a_aud'</span><span class="p">)]</span><span class="w">
</span><span class="n">x_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">a_aud</span><span class="p">))</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_dummy</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="w">

</span><span class="c1">######## Ridge ########</span><span class="w">
</span><span class="c1"># ridge 1 : 모든 변수를 이용해서 ridge cv</span><span class="w">
</span><span class="n">fit1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">cv1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">cv1</span><span class="o">$</span><span class="n">lambda.min</span><span class="w"> </span><span class="c1"># 0.6503258</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">cv1</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="s1">'lambda.min'</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit1</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="o">=</span><span class="s1">'lambda'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv1</span><span class="p">)</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">0.067</span><span class="p">)</span><span class="w"> </span><span class="c1"># -2.7 </span><span class="w">
           </span><span class="c1"># log(lambda)가 -2.7일때 최저의 mse</span><span class="w">

</span><span class="c1"># 최적의 람다로 재피팅 후 predict 구하기</span><span class="w">
</span><span class="n">ridge1.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv1</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span><span class="n">ridge1_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ridge.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv1</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'coefficients'</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">ridge1_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">ridge1_coef</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">ridge1_coef</span><span class="w">

</span><span class="c1"># newdata를 쓰나 안쓰나 coefficient 값은 동일</span><span class="w">
</span><span class="n">ridge1.yhat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ridge1.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv1</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test.x</span><span class="p">))</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test_y</span><span class="p">)</span><span class="w"> </span><span class="c1"># OLS :0.3470985</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">ridge1.yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test.y</span><span class="p">)</span><span class="w"> </span><span class="c1"># ridge : 0.2934386</span><span class="w">

</span><span class="c1">## ridge 2 : 8개 변수만을 이용해서 ridge cv</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span><span class="w">
</span><span class="c1"># weekday_kindon / covid후 / a_released / a_screen / careCnt / mean_high_wind / mean_av_wind / count</span><span class="w">
</span><span class="c1"># -&gt; weekdays_kind / covid / a_released / a_screen / careCnt / mean_high_wind / mean_av_wind / count</span><span class="w">
</span><span class="n">train.xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train.x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">a_released</span><span class="p">,</span><span class="w"> </span><span class="n">a_screen</span><span class="p">,</span><span class="w"> </span><span class="n">careCnt</span><span class="p">,</span><span class="w"> </span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">mean_av_wind</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">
</span><span class="n">test.xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test.x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">a_released</span><span class="p">,</span><span class="w"> </span><span class="n">a_screen</span><span class="p">,</span><span class="w"> </span><span class="n">careCnt</span><span class="p">,</span><span class="w"> </span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">mean_av_wind</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">
</span><span class="n">test_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">a_released</span><span class="p">,</span><span class="w"> </span><span class="n">a_screen</span><span class="p">,</span><span class="w"> </span><span class="n">careCnt</span><span class="p">,</span><span class="w"> </span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">mean_av_wind</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">

</span><span class="c1"># train.y는 동일</span><span class="w">
</span><span class="n">fit2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">cv2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">cv2</span><span class="o">$</span><span class="n">lambda.min</span><span class="w"> </span><span class="c1"># 0.06703521 -&gt; 0.0670562</span><span class="w">
</span><span class="n">ridge2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">cv2</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="s1">'lambda.min'</span><span class="p">),</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">ridge2_coef</span><span class="w"> </span><span class="c1"># 차이가 있음</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit2</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="o">=</span><span class="s1">'lambda'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv2</span><span class="p">)</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">0.067</span><span class="p">)</span><span class="w"> </span><span class="c1"># -2.7 </span><span class="w">
</span><span class="c1"># log(lambda)가 -2.7일때 최저의 mse</span><span class="w">

</span><span class="c1"># 8개 변수만으로 fitting</span><span class="w">
</span><span class="c1"># 최적의 람다로 재피팅 후 predict 구하기</span><span class="w">
</span><span class="n">ridge2.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv2</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span><span class="n">ridge2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ridge2.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv2</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'coefficients'</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">test_new</span><span class="p">)</span><span class="w">
</span><span class="n">ridge2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">ridge2_coef</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">ridge2_coef</span><span class="w">
</span><span class="n">ridge1_coef</span><span class="w"> </span><span class="c1"># 비교</span><span class="w">
</span><span class="c1"># newdata를 쓰나 안쓰나 coefficient 값은 동일</span><span class="w">
</span><span class="n">ridge2.yhat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">ridge2.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv2</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test.xx</span><span class="p">))</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test_y</span><span class="p">)</span><span class="w"> </span><span class="c1"># OLS :0.3470985</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">ridge1.yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test.y</span><span class="p">)</span><span class="w"> </span><span class="c1"># ridge : 0.2934386</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">ridge2.yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test.y</span><span class="p">)</span><span class="w"> </span><span class="c1"># ridge : 0.2866408</span><span class="w">

</span><span class="c1">###### Lasso #######</span><span class="w">
</span><span class="c1"># lasso 1 : 모든 변수를 이용해서 lasso cv</span><span class="w">
</span><span class="n">fit3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.x</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">cv3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.x</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">cv3</span><span class="o">$</span><span class="n">lambda.min</span><span class="w"> </span><span class="c1"># 0.001444682</span><span class="w">
</span><span class="n">coef</span><span class="p">(</span><span class="n">cv3</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="s1">'lambda.min'</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit3</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="o">=</span><span class="s1">'lambda'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv3</span><span class="p">)</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">0.001444682</span><span class="p">)</span><span class="w"> </span><span class="c1"># -6.539866</span><span class="w">

</span><span class="c1"># 최적의 람다로 재피팅 후 predict 구하기</span><span class="w">
</span><span class="n">lasso1.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.x</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv3</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span><span class="n">lasso1_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso1.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv3</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'coefficients'</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">lasso1_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">lasso1_coef</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">lasso1_coef</span><span class="w">  </span><span class="c1"># coef(cv3, s='lambda.min')와 같음</span><span class="w">
</span><span class="n">lasso1.yhat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso1.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv3</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test.x</span><span class="p">))</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">lasso1.yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test.y</span><span class="p">)</span><span class="w"> </span><span class="c1"># lasso : 0.3013272</span><span class="w">

</span><span class="c1">## lasso 2 : 8개 변수를 이용해서 lasso_cv</span><span class="w">
</span><span class="n">train.xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train.x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">a_released</span><span class="p">,</span><span class="w"> </span><span class="n">a_screen</span><span class="p">,</span><span class="w"> </span><span class="n">careCnt</span><span class="p">,</span><span class="w"> </span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">mean_av_wind</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">
</span><span class="n">test.xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test.x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">covid</span><span class="p">,</span><span class="w"> </span><span class="n">a_released</span><span class="p">,</span><span class="w"> </span><span class="n">a_screen</span><span class="p">,</span><span class="w"> </span><span class="n">careCnt</span><span class="p">,</span><span class="w"> </span><span class="n">mean_high_wind</span><span class="p">,</span><span class="w"> </span><span class="n">mean_av_wind</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w">

</span><span class="c1"># train.y는 동일</span><span class="w">
</span><span class="n">fit4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">cv4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cv.glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">cv4</span><span class="o">$</span><span class="n">lambda.min</span><span class="w"> </span><span class="c1"># 0.001444682 -&gt; 0.0008267002 (더 낮아짐)</span><span class="w">
</span><span class="n">lasso2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">coef</span><span class="p">(</span><span class="n">cv4</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="s1">'lambda.min'</span><span class="p">),</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">lasso2_coef</span><span class="w"> </span><span class="c1"># 차이가 있음</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fit4</span><span class="p">,</span><span class="w"> </span><span class="n">xvar</span><span class="o">=</span><span class="s1">'lambda'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cv4</span><span class="p">)</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="m">0.0008267002</span><span class="p">)</span><span class="w"> </span><span class="c1"># -7.098068</span><span class="w">

</span><span class="c1"># 8개 변수만으로 fitting</span><span class="w">
</span><span class="c1"># 최적의 람다로 재피팅 후 predict 구하기</span><span class="w">
</span><span class="n">lasso2.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glmnet</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.xx</span><span class="p">),</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">train.y</span><span class="p">),</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'gaussian'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv4</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">)</span><span class="w">
</span><span class="n">lasso2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso2.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv4</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'coefficients'</span><span class="p">,</span><span class="n">newdata</span><span class="o">=</span><span class="n">test_new</span><span class="p">)</span><span class="w">
</span><span class="n">lasso2_coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">lasso2_coef</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">lasso2_coef</span><span class="w">

</span><span class="c1"># newdata를 쓰나 안쓰나 coefficient 값은 동일</span><span class="w">
</span><span class="n">lasso2.yhat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">lasso2.fit</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="n">cv4</span><span class="o">$</span><span class="n">lambda.min</span><span class="p">,</span><span class="w"> </span><span class="n">newx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">test.xx</span><span class="p">))</span><span class="w">
</span><span class="n">te.mse</span><span class="p">(</span><span class="n">lasso2.yhat</span><span class="p">,</span><span class="w"> </span><span class="n">test.y</span><span class="p">)</span><span class="w"> </span><span class="c1"># lasso : 0.292503</span><span class="w">

</span><span class="c1"># 랜덤포레스트와 부스팅은 나중에</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1">#####################</span><span class="w">
</span><span class="c1"># all_box = 더미 변수 만들기 전</span><span class="w">
</span><span class="c1"># all_new2 = 더미변수 만든 후</span><span class="w">
</span><span class="c1"># random forest 적용하려고 만든 코드</span><span class="w">
</span><span class="n">all_dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">all_1_noout</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">weekdays_kind</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'on'</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w">
                                     </span><span class="n">d_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">d_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'comfy'</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w">
                                     </span><span class="n">covid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">covid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'후'</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">))</span><span class="w"> 
</span><span class="n">str</span><span class="p">(</span><span class="n">all_dummy</span><span class="p">)</span><span class="w">

</span><span class="c1">## 더미변수 만든 후 모델 돌려보기</span><span class="w">
</span><span class="c1"># 더미변수 만들기 전과 비교해보았을 때 summary 결과가 같음</span><span class="w">
</span><span class="n">d_dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="w"> </span><span class="n">weekdays_kind</span><span class="o">+</span><span class="n">covid</span><span class="o">+</span><span class="n">a_released</span><span class="o">+</span><span class="n">a_screen</span><span class="o">+</span><span class="n">careCnt</span><span class="o">+</span><span class="n">mean_high_wind</span><span class="o">+</span><span class="n">mean_av_wind</span><span class="o">+</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">all_dummy</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">d_dummy</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">d_new</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">all_1_noout</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_1_noout</span><span class="p">)</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createDataPartition</span><span class="p">(</span><span class="n">all_dummy</span><span class="o">$</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="w">
</span><span class="n">train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_1_noout</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_1_noout</span><span class="p">[</span><span class="o">-</span><span class="n">idx</span><span class="p">,]</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">all_dummy</span><span class="p">)</span><span class="w"> </span><span class="c1"># 1051</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="w"> </span><span class="c1"># 842</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="c1"># 209</span><span class="w">
</span><span class="n">test_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">$</span><span class="n">a_aud</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all_dummy</span><span class="p">)</span><span class="w">
</span><span class="c1"># 에러 : variables ‘weekdays_kind’, ‘covid’ were specified with different types from the fit</span><span class="w">
</span><span class="c1"># predict(d_dummy, newdata = test, interval = 'confidence')</span><span class="w">
</span><span class="c1"># yhat = predict(d_dummy, newdata = test)</span><span class="w">
</span><span class="c1"># yhat</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># yhat - test_y</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># mean(abs(yhat- test_y)) # MAE : 0.4575668</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># mean((yhat- test_y)^2) #MSE : 0.3470985</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># sqrt(mean((yhat- test_y)^2)) # rMSE : 0.5891507</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># summary(d_new) # 67퍼의 설명력</span><span class="w">

</span><span class="c1"># tidymodels 이용하기 </span><span class="w">
</span><span class="c1">### 랜덤포레스트 ###</span><span class="w">
</span><span class="c1"># RF</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidymodels</span><span class="p">)</span><span class="w">
</span><span class="c1"># install.packages('tidymodels')</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">all</span><span class="p">)</span><span class="w">
</span><span class="n">split</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">all_box</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="n">covid</span><span class="p">,</span><span class="n">weekdays</span><span class="p">,</span><span class="n">weekdays_kind</span><span class="p">,</span><span class="n">d_index</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">initial_split</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">split</span><span class="w">
</span><span class="n">split</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">training</span><span class="p">()</span><span class="w">
</span><span class="n">split</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">testing</span><span class="p">()</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="w">

</span><span class="c1"># 모든 변수 다 사용해보기 # x 변수 : 16개</span><span class="w">
</span><span class="n">recipe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">training</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">recipe</span><span class="p">(</span><span class="n">a_aud</span><span class="w"> </span><span class="o">~</span><span class="n">.</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">step_corr</span><span class="p">(</span><span class="n">all_predictors</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">step_center</span><span class="p">(</span><span class="n">all_predictors</span><span class="p">(),</span><span class="w"> </span><span class="o">-</span><span class="n">all_outcomes</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">step_scale</span><span class="p">(</span><span class="n">all_predictors</span><span class="p">(),</span><span class="w"> </span><span class="o">-</span><span class="n">all_outcomes</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">prep</span><span class="p">()</span><span class="w">
</span><span class="n">recipe</span><span class="w"> </span><span class="c1"># 다중공산성 문제는 없음</span><span class="w">
</span><span class="n">testing</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">bake</span><span class="p">(</span><span class="n">split</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">testing</span><span class="p">())</span><span class="w"> 

</span><span class="c1"># juice</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recipe</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">juice</span><span class="p">()</span><span class="w">
</span><span class="n">training</span><span class="w">
</span><span class="c1"># modeling</span><span class="w">
</span><span class="n">rf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rand_forest</span><span class="p">(</span><span class="n">trees</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="s1">'regression'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">set_engine</span><span class="p">(</span><span class="s1">'randomForest'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">fit</span><span class="p">(</span><span class="n">a_aud</span><span class="o">~</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="w"> </span><span class="n">training</span><span class="p">)</span><span class="w">
</span><span class="n">rf</span><span class="w">
</span><span class="n">rf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">predict</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">rf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">predict</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">bind_cols</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w">

</span><span class="c1"># 성능 검증</span><span class="w">
</span><span class="n">rf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">predict</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">bind_cols</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">metrics</span><span class="p">(</span><span class="n">truth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a_aud</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="o">=</span><span class="w"> </span><span class="n">.pred</span><span class="p">)</span><span class="w">

</span><span class="c1"># 랜덤포레스트 - adjR^2: 0.812</span><span class="w">
</span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rf</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">testing</span><span class="p">)</span><span class="w">
</span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred</span><span class="o">$</span><span class="n">.pred</span><span class="w">
</span><span class="n">real_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testing</span><span class="o">$</span><span class="n">a_aud</span><span class="w">
</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pred</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">real_y</span><span class="p">)</span><span class="o">/</span><span class="n">real_y</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w">

</span><span class="c1">### 0601 shiny 활용</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">shiny</span><span class="p">)</span><span class="w">

</span><span class="n">getwd</span><span class="p">()</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"C:/Users/eric3/Documents/AI 프로젝트/0524/final_cor/shiny"</span><span class="p">)</span><span class="w">
</span><span class="n">getwd</span><span class="p">()</span><span class="w">
</span><span class="n">runApp</span><span class="p">()</span><span class="w">
</span></pre></table></code></div></div></div></details></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/project/'>Project</a>, <a href='/categories/kfq/'>KFQ</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/r/" class="post-tag no-text-decoration" >R</a> <a href="/tags/machinelearning/" class="post-tag no-text-decoration" >MachineLearning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%5BKFQ%5D+KFQ+1%EC%B0%A8+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%2F+%EA%B5%AD%EB%82%B4+%EC%98%81%ED%99%94%EA%B4%80%EB%9E%8C%EA%B0%9D%EC%88%98+%EC%98%88%EC%B8%A1+-+19tak&url=https%3A%2F%2F19tak.github.io%2Fposts%2F01-prj1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%5BKFQ%5D+KFQ+1%EC%B0%A8+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%2F+%EA%B5%AD%EB%82%B4+%EC%98%81%ED%99%94%EA%B4%80%EB%9E%8C%EA%B0%9D%EC%88%98+%EC%98%88%EC%B8%A1+-+19tak&u=https%3A%2F%2F19tak.github.io%2Fposts%2F01-prj1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2F19tak.github.io%2Fposts%2F01-prj1%2F&text=%5BKFQ%5D+KFQ+1%EC%B0%A8+%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8+%2F+%EA%B5%AD%EB%82%B4+%EC%98%81%ED%99%94%EA%B4%80%EB%9E%8C%EA%B0%9D%EC%88%98+%EC%98%88%EC%B8%A1+-+19tak" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/03-process_modeling/">[IT] 프로세스 모델링 이해 03 - 분석 개요</a><li><a href="/posts/04-process_modeling/">[IT] 프로세스 모델링 이해 04 - 분석 / 현행 시스템 분석</a><li><a href="/posts/02-process_modeling/">[IT] 프로세스 모델링 이해 02 - 프로세스 모델링 개요, 절차</a><li><a href="/posts/01-process_modeling/">[IT] 프로세스 모델링 이해 01 - 개요</a><li><a href="/posts/fmtc_02/">[FMTC] FMTC 원격주행 시스템 개발 02 - </a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/jupyter-notebook/">Jupyter Notebook</a> <a class="post-tag" href="/tags/robot/">Robot</a> <a class="post-tag" href="/tags/ros/">ROS</a> <a class="post-tag" href="/tags/deeplearning/">DeepLearning</a> <a class="post-tag" href="/tags/machinelearning/">MachineLearning</a> <a class="post-tag" href="/tags/mechanical-engineering/">Mechanical Engineering</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/01-r/"><div class="card-body"> <em class="small" data-ts="1627830000" data-df="YYYY-MM-DD" > 2021-08-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[R] 데이터 분석 환경 만들기</h3><div class="text-muted small"><p> 본 포스팅은 “Do it! 쉽게 배우는 R 데이터 분석” - (이지스퍼블리싱, 데이터 분석가 김영우 지음)을 바탕으로 공부한 내용을 정리한 것입니다. R이란? R 설치 R과 R Studio 설치 프로젝트 생성 환경설정 데이터 분석 준비 변수 함수 ...</p></div></div></a></div><div class="card"> <a href="/posts/01-ml/"><div class="card-body"> <em class="small" data-ts="1629126000" data-df="YYYY-MM-DD" > 2021-08-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ML] 파이썬 머신러닝 환경 구성</h3><div class="text-muted small"><p> 본 포스팅은 “파이썬 머신러닝 완벽가이드” - (위키북스, 권철민 지음)을 바탕으로 공부한 내용을 정리한 것입니다. 머신러닝, Python vs R Anaconda, Jupyter Notebook Anaconda 설치 설치 확인 Microsoft Visual Studio Build Tools ...</p></div></div></a></div><div class="card"> <a href="/posts/02-ml/"><div class="card-body"> <em class="small" data-ts="1629126000" data-df="YYYY-MM-DD" > 2021-08-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[ML] Jupyter Notebook 초기 폴더 설정</h3><div class="text-muted small"><p> Jupyter Notebook의 Default Directory는 C:\Users\사용자명이다. 본인이 원하는 경로로 수정하여 Anaconda Prompt에서 바로 접속해보자. Anaconda3 - Jupyter Notebook - 자세히 - 파일 위치 열기 Jupyter Notebook 우클릭 - 속...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/01-rl/" class="btn btn-outline-primary" prompt="이전 글"><p>[RL] 강화 학습 개념과 마르코프 결정, 벨만 방정식, 정책 반복법, 모델 기반 강화학습</p></a> <a href="/posts/02-rl/" class="btn btn-outline-primary" prompt="다음 글"><p>[RL] 모델 프리 강화 학습</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/jupyter-notebook/">Jupyter Notebook</a> <a class="post-tag" href="/tags/robot/">Robot</a> <a class="post-tag" href="/tags/ros/">ROS</a> <a class="post-tag" href="/tags/deeplearning/">DeepLearning</a> <a class="post-tag" href="/tags/machinelearning/">MachineLearning</a> <a class="post-tag" href="/tags/mechanical-engineering/">Mechanical Engineering</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/19tak">19tak</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">새 버전의 콘텐츠를 사용할 수 있습니다.</p><button type="button" class="btn btn-primary" aria-label="Update"> 업데이트 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
